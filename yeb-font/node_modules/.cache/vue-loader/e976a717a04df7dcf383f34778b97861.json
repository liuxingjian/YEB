{"remainingRequest":"D:\\workplace\\myProject\\yeb\\yeb1\\yeb\\yeb-font\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workplace\\myProject\\yeb\\yeb1\\yeb\\yeb-font\\src\\components\\sys\\basic\\PermissMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workplace\\myProject\\yeb\\yeb1\\yeb\\yeb-font\\src\\components\\sys\\basic\\PermissMana.vue","mtime":1666527853824},{"path":"D:\\workplace\\myProject\\yeb\\yeb1\\yeb\\yeb-font\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1666529050686},{"path":"D:\\workplace\\myProject\\yeb\\yeb1\\yeb\\yeb-font\\node_modules\\babel-loader\\lib\\index.js","mtime":1666529051466},{"path":"D:\\workplace\\myProject\\yeb\\yeb1\\yeb\\yeb-font\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1666529050686},{"path":"D:\\workplace\\myProject\\yeb\\yeb1\\yeb\\yeb-font\\node_modules\\vue-loader\\lib\\index.js","mtime":1666529052140}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgICBleHBvcnQgZGVmYXVsdCB7CiAgICAgICAgbmFtZTogIlBlcm1pc3NNYW5hIiwKICAgICAgICBkYXRhKCl7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgIHJvbGU6IHsKICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLAogICAgICAgICAgICAgICAgICAgbmFtZVpoOiAnJwogICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcm9sZXM6IFtdLAogICAgICAgICAgICAgICAgbWVudXM6IFtdLAogICAgICAgICAgICAgICAgZGVmYXVsdFByb3BzOiB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicsCiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICduYW1lJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlbGVjdGVkTWVudXM6IFtdLAogICAgICAgICAgICAgICAgYWN0aXZlTmFtZTogLTEKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW91bnRlZCgpIHsKICAgICAgICAgICAgdGhpcy5pbml0Um9sZXMoKTsKICAgICAgICB9LAogICAgICAgIG1ldGhvZHM6IHsKICAgICAgICAgICAgZGVsZXRlUm9sZShyb2xlKXsKICAgICAgICAgICAgICAgIHRoaXMuJGNvbmZpcm0oJ+atpOaTjeS9nOWwhuawuOS5heWIoOmZpOOAkCcrcm9sZS5uYW1lWmgrJ+OAkeinkuiJsiwg5piv5ZCm57un57utPycsICfmj5DnpLonLCB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWxldGVSZXF1ZXN0KCcvc3lzdGVtL2Jhc2ljL3Blcm1pc3MvL2RlbGV0ZS8nK3JvbGUuaWQpLnRoZW4ocmVzcD0+ewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRSb2xlcygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2luZm8nLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAn5bey5Y+W5raI5Yig6ZmkJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFkZFJvbGUoKXsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvbGUubmFtZSAmJiB0aGlzLnJvbGUubmFtZVpoKXsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc3RSZXF1ZXN0KCcvc3lzdGVtL2Jhc2ljL3Blcm1pc3MvYWRkLycsdGhpcy5yb2xlKS50aGVuKHJlc3A9PnsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3ApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0Um9sZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9sZSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLmiYDmnInlhoXlrrnkuI3og73kuLrnqbrvvIEiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjYW5jZWxVcGRhdGUoKXsKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlTmFtZSA9IC0xCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRvVXBkYXRlKHJpZCxpbmRleCl7CiAgICAgICAgICAgICAgICBsZXQgdHJlZSA9IHRoaXMuJHJlZnMudHJlZVtpbmRleF0KICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZEtleXMgPSB0cmVlLmdldENoZWNrZWRLZXlzKHRydWUpCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhzZWxlY3RlZEtleXMpCiAgICAgICAgICAgICAgICBsZXQgdXJsID0gJy9zeXN0ZW0vYmFzaWMvcGVybWlzcy91cGRhdGVNZW51Um9sZS8/cmlkPScgKyByaWQgKyAnJm1pZD0nICsgc2VsZWN0ZWRLZXlzCiAgICAgICAgICAgICAgICAvLyBzZWxlY3RlZEtleXMuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgICAgLy8gICAgIHVybCArPSAnJm1pZHM9JyArIGtleQogICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgIHRoaXMucHV0UmVxdWVzdCh1cmwpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0U2VsZWN0ZWRNZW51cyhyaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZU5hbWUgPSAtMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBpbml0U2VsZWN0ZWRNZW51cyhyaWQpewogICAgICAgICAgICAgICAgdGhpcy5nZXRSZXF1ZXN0KCcvc3lzdGVtL2Jhc2ljL3Blcm1pc3MvbWlkLycrcmlkKS50aGVuKHJlcyA9PnsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE1lbnVzID0gcmVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2hhbmdlKHJpZCl7CiAgICAgICAgICAgICAgICBpZiAocmlkKXsKICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRNZW51cygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdFNlbGVjdGVkTWVudXMocmlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5pdE1lbnVzKCl7CiAgICAgICAgICAgICAgICB0aGlzLmdldFJlcXVlc3QoJy9zeXN0ZW0vYmFzaWMvcGVybWlzcy9tZW51cycpLnRoZW4ocmVzID0+ewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMpewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVzID0gcmVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5pdFJvbGVzKCl7CiAgICAgICAgICAgICAgICB0aGlzLmdldFJlcXVlc3QoJy9zeXN0ZW0vYmFzaWMvcGVybWlzcy9saXN0QWxsJykudGhlbihyZXMgPT57CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9sZXMgPSByZXMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQo="},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\n    <div>\n        <div class=\"permissionManaTool\">\n            <el-input size=\"small\" placeholder=\"请输入英文名\" v-model=\"role.name\" @keydown.enter.native=\"addRole\">\n                <template slot=\"prepend\">ROLE_</template>\n            </el-input>\n            <el-input size=\"small\" v-model=\"role.nameZh\" placeholder=\"请输入中文名\" @keydown.enter.native=\"addRole\"></el-input>\n            <el-button size=\"small\" type=\"primary\" icon=\"el-icon-plus\" @click=\"addRole\">添加角色</el-button>\n        </div>\n        <div class=\"permissionManaMain\">\n            <el-collapse accordion v-model=\"activeName\" @change=\"change\">\n                <el-collapse-item v-for=\"(item,index) in roles\" :key=\"index\" :title=\"item.nameZh\" :name=\"item.id\">\n                    <el-card class=\"box-card\">\n                        <div slot=\"header\" class=\"clearfix\">\n                            <span>可访问资源</span>\n                            <el-button\n                                    style=\"float: right; padding: 3px 0;color: red\"\n                                    icon=\"el-icon-delete\"\n                                    type=\"text\"\n                                    @click=\"deleteRole(item)\"\n                            ></el-button>\n                        </div>\n                        <div>\n                            <el-tree\n                                    show-checkbox\n                                    ref=\"tree\"\n                                    :data=\"menus\"\n                                    :key=\"index\"\n                                    :props=\"defaultProps\"\n                                    :default-checked-keys=\"selectedMenus\"\n                                    node-key=\"id\"\n                            ></el-tree>\n                            <div style=\"display: flex;justify-content: flex-end\">\n                                <el-button size=\"mini\" @click=\"cancelUpdate\">取消修改</el-button>\n                                <el-button size=\"mini\" type=\"primary\" @click=\"doUpdate(item.id,index)\">确认修改</el-button>\n                            </div>\n                        </div>\n                    </el-card>\n                </el-collapse-item>\n            </el-collapse>\n        </div>\n    </div>\n</template>\n\n<script>\n    export default {\n        name: \"PermissMana\",\n        data(){\n            return {\n               role: {\n                   name: '',\n                   nameZh: ''\n               },\n                roles: [],\n                menus: [],\n                defaultProps: {\n                    children: 'children',\n                    label: 'name'\n                },\n                selectedMenus: [],\n                activeName: -1\n            }\n        },\n        mounted() {\n            this.initRoles();\n        },\n        methods: {\n            deleteRole(role){\n                this.$confirm('此操作将永久删除【'+role.nameZh+'】角色, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    this.deleteRequest('/system/basic/permiss//delete/'+role.id).then(resp=>{\n                        if (resp){\n                            this.initRoles();\n                        }\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消删除'\n                    });\n                });\n            },\n            addRole(){\n                if (this.role.name && this.role.nameZh){\n                    this.postRequest('/system/basic/permiss/add/',this.role).then(resp=>{\n                        if (resp){\n                            this.initRoles();\n                            this.role = {};\n                        }\n                    })\n                }else {\n                    this.$message.error(\"所有内容不能为空！\")\n                }\n            },\n            cancelUpdate(){\n                this.activeName = -1\n            },\n            doUpdate(rid,index){\n                let tree = this.$refs.tree[index]\n                let selectedKeys = tree.getCheckedKeys(true)\n                // console.log(selectedKeys)\n                let url = '/system/basic/permiss/updateMenuRole/?rid=' + rid + '&mid=' + selectedKeys\n                // selectedKeys.forEach(key => {\n                //     url += '&mids=' + key\n                // })\n                this.putRequest(url).then(res => {\n                    if (res){\n                        this.initSelectedMenus(rid);\n                        this.activeName = -1;\n                    }\n                })\n            },\n            initSelectedMenus(rid){\n                this.getRequest('/system/basic/permiss/mid/'+rid).then(res =>{\n                    if (res){\n                        this.selectedMenus = res\n                    }\n                })\n            },\n            change(rid){\n                if (rid){\n                    this.initMenus();\n                    this.initSelectedMenus(rid);\n                }\n            },\n            initMenus(){\n                this.getRequest('/system/basic/permiss/menus').then(res =>{\n                    if (res){\n                        this.menus = res\n                    }\n                })\n            },\n            initRoles(){\n                this.getRequest('/system/basic/permiss/listAll').then(res =>{\n                    if (res){\n                        this.roles = res\n                    }\n                })\n            }\n        }\n    }\n</script>\n\n<style scoped>\n    .permissionManaTool{\n        display: flex;\n        justify-content: flex-start;\n    }\n    .permissionManaTool .el-input{\n        width: 300px;\n        margin-right: 6px;\n    }\n    .permissionManaMain{\n        width: 700px;\n        margin-top: 10px;\n    }\n</style>\n"]}]}